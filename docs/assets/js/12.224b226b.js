(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{419:function(s,a,e){"use strict";e.r(a);var t=e(2),r=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h3",{attrs:{id:"任务-在指定内网服务器搭建docker-swarm集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#任务-在指定内网服务器搭建docker-swarm集群"}},[s._v("#")]),s._v(" 任务：在指定内网服务器搭建Docker Swarm集群")]),s._v(" "),a("p",[s._v("172.25.16.141、172.25.16.142、172.25.16.143")]),s._v(" "),a("h3",{attrs:{id:"设置各节点hostname"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置各节点hostname"}},[s._v("#")]),s._v(" 设置各节点hostname")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("hostnamectl set-hostname app141\nhostnamectl set-hostname app142\nhostnamectl set-hostname app143\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"创建swarm集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建swarm集群"}},[s._v("#")]),s._v(" 创建swarm集群")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" swarm init --advertise-addr "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.25")]),s._v(".16.141\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"其他节点加入swarm集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他节点加入swarm集群"}},[s._v("#")]),s._v(" 其他节点加入swarm集群")]),s._v(" "),a("p",[a("strong",[s._v("查看join-token")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" swarm join-token "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("woker"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("manager"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("manager节点")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" swarm "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" --advertise-addr "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.25")]),s._v(".16.142 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--token")]),s._v(" SWMTKN-1-3da754ia2vf46adhdoyk67whg5cyg0978mo6442f7ebpul3qhc-3777p0l0ce1ja25bmuydqb782 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.25")]),s._v(".16.141:2377\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("worker节点")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" swarm "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" --advertise-addr "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.25")]),s._v(".16.142 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--token")]),s._v(" SWMTKN-1-3da754ia2vf46adhdoyk67whg5cyg0978mo6442f7ebpul3qhc-eeh5o7wr0iv78stw7f35ubu14 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.25")]),s._v(".16.141:2377\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"配置swarm网络"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置swarm网络"}},[s._v("#")]),s._v(" 配置swarm网络")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" network create "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--scope")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("swarm "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--attachable")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--driver")]),s._v(" overlay app-server\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"镜像拉取测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#镜像拉取测试"}},[s._v("#")]),s._v(" 镜像拉取测试")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull nexus.ubssdic.com:8445/nginx:latest\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("此时执行docker pull 发现存在网卡冲突问题")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://blog-chy.oss-cn-shenzhen.aliyuncs.com/static/image-20230417094310680.png",alt:"image-20230417094310680"}})]),s._v(" "),a("h3",{attrs:{id:"更改网桥网卡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更改网桥网卡"}},[s._v("#")]),s._v(" 更改网桥网卡")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 断开默认使用docker_gwbridge网卡的gateway_ingress-sbox网络")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" network disconnect "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" docker_gwbridge gateway_ingress-sbox\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除docker_gwbridge网桥网卡")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" network "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" docker_gwbridge\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重建网卡 并指定子网")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" network create "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--subnet")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.1/16 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--opt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("com.docker.network.bridge.name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("docker_gwbridge "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\ndocker_gwbridge\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启docker服务")]),s._v("\nsystemctl restart docker.service\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("在每台集群机器均进行以上操作，完成后拉取镜像恢复正常。至此Docker Swarm集群搭建完成。")])])}),[],!1,null,null,null);a.default=r.exports}}]);